@using EInvoice.Common.DTO
@model InvoiceDTO

@{
    ViewData["Title"] = "Add Invoice";
}

<h2>Add Invoice</h2>

<form asp-action="Add" method="post">
    <div class="d-flex justify-content-between">
        <div class="form-group col-4">
            <label asp-for="InvoiceRefNo"></label>
            <input asp-for="InvoiceRefNo" class="form-control" />
            <span asp-validation-for="InvoiceRefNo" class="text-danger"></span>
        </div>

        <div class="form-group col-4">
            <label asp-for="InvoiceDate"></label>
            <input asp-for="InvoiceDate" type="date" class="form-control" />
            <span asp-validation-for="InvoiceDate" class="text-danger"></span>
        </div>
        <div class="form-group col-4">
            <label asp-for="InvoiceType">Invoice Type</label>
            <select asp-for="InvoiceType"
                    asp-items="@(new SelectList(Model.InvoiceTypes, "Id", "Type"))"
                    class="form-control">
                <option value="">-- Select Invoice Type --</option>
            </select>
            <span asp-validation-for="InvoiceType" class="text-danger"></span>
        </div>
        <div class="form-group col-4">
            <label asp-for="BuyerId">Buyer</label>
            <select asp-for="BuyerId"
                    asp-items="@(new SelectList(Model.Clients, "Id", "BusinessName"))"
                    class="form-control">
                <option value="">-- Select Buyer --</option>
            </select>
            <span asp-validation-for="BuyerId" class="text-danger"></span>
        </div>
    </div>

    <h4>Invoice Items</h4>
    <table class="table" id="invoiceItemsTable">
        <thead>
            <tr>
                <th>Product</th>
                <th>Description</th>
                <th>HS Code</th>
                <th>UoM</th>
                <th>Rate</th>
                <th>Qty</th>
                <th>Total</th>
                <th>Tax Rate</th>
                <th>Sales Tax</th>
                <th>Discount</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.InvoiceItems.Count; i++)
            {
                <tr data-index="@i">
                    <td>
                        <select name="InvoiceItems[@i].ProductId"
                                class="form-control product-select"
                                asp-items="@(new SelectList(Model.Products, "Id", "Name", Model.InvoiceItems[i].ProductId))">
                            <option value="">-- Select Product --</option>
                        </select>
                        <span asp-validation-for="InvoiceItems[i].ProductId" class="text-danger"></span>
                    </td>
                    <td>
                        <input type="text" class="form-control description"
                               name="InvoiceItems[@i].ProductDescription"
                               value="@Model.InvoiceItems[i].ProductDescription" readonly />
                        <span asp-validation-for="InvoiceItems[i].ProductDescription" class="text-danger"></span>
                    </td>
                    <td>
                        <input type="text" class="form-control hsCode" name="InvoiceItems[@i].HsCode"
                               value="@Model.InvoiceItems[@i].HsCode" readonly />
                        <span asp-validation-for="InvoiceItems[i].HsCode" class="text-danger"></span>
                    </td>
                    <td>
                        <input type="text" class="form-control uom" name="InvoiceItems[@i].UoM" value="@Model.InvoiceItems[@i].UoM" readonly />
                        <span asp-validation-for="InvoiceItems[i].UoM" class="text-danger"></span>

                    </td>
                    <td>
                        <input type="number" class="form-control rate" name="InvoiceItems[@i].Rate" value="@Model.InvoiceItems[@i].Rate" readonly />
                        <span asp-validation-for="InvoiceItems[i].Rate" class="text-danger"></span>

                    </td>
                    <td>
                        <input type="number" class="form-control quantity" name="InvoiceItems[@i].Quantity" value="@Model.InvoiceItems[@i].Quantity" min="1" />
                        <span asp-validation-for="InvoiceItems[i].Quantity" class="text-danger"></span>

                    </td>
                    <td>
                        <input type="number" class="form-control totalValue" name="InvoiceItems[@i].TotalValue" value="@Model.InvoiceItems[@i].TotalValue" readonly />
                        <span asp-validation-for="InvoiceItems[i].TotalValue" class="text-danger"></span>

                    </td>
                    <td>
                        <input type="text" class="form-control taxRate" name="InvoiceItems[@i].TaxRate" value="@Model.InvoiceItems[@i].TaxRate" readonly />
                        <span asp-validation-for="InvoiceItems[i].TaxRate" class="text-danger"></span>

                    </td>
                    <td>
                        <input type="number" class="form-control salesTax" name="InvoiceItems[@i].SalesTaxApplicable" value="@Model.InvoiceItems[@i].SalesTaxApplicable" readonly />
                        <span asp-validation-for="InvoiceItems[i].SalesTaxApplicable" class="text-danger"></span>

                    </td>
                    <td>
                        <input type="number" class="form-control discount" name="InvoiceItems[@i].Discount" value="@Model.InvoiceItems[@i].Discount"/>
                        <span asp-validation-for="InvoiceItems[i].Discount" class="text-danger"></span>

                    </td>
                    <td></td>
                </tr>
            }
            @if (Model.InvoiceItems.Count == 0)
            {
                <tr data-index="0">
                    <td>
                        <select name="InvoiceItems[0].ProductId"
                                class="form-control product-select"
                                asp-items="@(new SelectList(Model.Products, "Id", "Name"))">
                            <option value="">-- Select Product --</option>
                        </select>
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].ProductId"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="text" class="form-control description" name="InvoiceItems[0].ProductDescription" readonly />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].ProductDescription"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="text" class="form-control hsCode" name="InvoiceItems[0].HsCode" readonly />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].HsCode"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="text" class="form-control uom" name="InvoiceItems[0].UoM" readonly />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].UoM"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="number" class="form-control rate" name="InvoiceItems[0].Rate" readonly />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].Rate"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="number" class="form-control quantity" name="InvoiceItems[0].Quantity" value="1" min="1" />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].Quantity"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="number" class="form-control totalValue" name="InvoiceItems[0].TotalValue" readonly />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].TotalValue"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="text" class="form-control taxRate" name="InvoiceItems[0].TaxRate" readonly />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].TaxRate"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="number" class="form-control salesTax" name="InvoiceItems[0].SalesTaxApplicable" readonly />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].SalesTaxApplicable"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td>
                        <input type="number" class="form-control discount" name="InvoiceItems[0].Discount" value="0" />
                        <span class="text-danger field-validation-valid"
                              data-valmsg-for="InvoiceItems[0].Discount"
                              data-valmsg-replace="true"></span>
                    </td>
                    <td></td>
                </tr>
            }
        </tbody>
    </table>
    <button type="button" id="addItemBtn" class="btn btn-secondary">Add Item</button>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Save Invoice</button>
    </div>
</form>

@section Scripts {
    <script src="~/js/invoice/add-invoice.js"></script>
}
